{"ast":null,"code":"module.exports = EntryWriter;\nvar tar = require(\"../tar.js\"),\n  TarHeader = require(\"./header.js\"),\n  Entry = require(\"./entry.js\"),\n  inherits = require(\"inherits\"),\n  BlockStream = require(\"block-stream\"),\n  ExtendedHeaderWriter,\n  Stream = require(\"stream\").Stream,\n  EOF = {};\ninherits(EntryWriter, Stream);\nfunction EntryWriter(props) {\n  var me = this;\n  if (!(me instanceof EntryWriter)) {\n    return new EntryWriter(props);\n  }\n  Stream.apply(this);\n  me.writable = true;\n  me.readable = true;\n  me._stream = new BlockStream(512);\n  me._stream.on(\"data\", function (c) {\n    me.emit(\"data\", c);\n  });\n  me._stream.on(\"drain\", function () {\n    me.emit(\"drain\");\n  });\n  me._stream.on(\"end\", function () {\n    me.emit(\"end\");\n    me.emit(\"close\");\n  });\n  me.props = props;\n  if (props.type === \"Directory\") {\n    props.size = 0;\n  }\n  props.ustar = \"ustar\\0\";\n  props.ustarver = \"00\";\n  me.path = props.path;\n  me._buffer = [];\n  me._didHeader = false;\n  me._meta = false;\n  me.on(\"pipe\", function () {\n    me._process();\n  });\n}\nEntryWriter.prototype.write = function (c) {\n  // console.error(\".. ew write\")\n  if (this._ended) return this.emit(\"error\", new Error(\"write after end\"));\n  this._buffer.push(c);\n  this._process();\n  this._needDrain = this._buffer.length > 0;\n  return !this._needDrain;\n};\nEntryWriter.prototype.end = function (c) {\n  // console.error(\".. ew end\")\n  if (c) this._buffer.push(c);\n  this._buffer.push(EOF);\n  this._ended = true;\n  this._process();\n  this._needDrain = this._buffer.length > 0;\n};\nEntryWriter.prototype.pause = function () {\n  // console.error(\".. ew pause\")\n  this._paused = true;\n  this.emit(\"pause\");\n};\nEntryWriter.prototype.resume = function () {\n  // console.error(\".. ew resume\")\n  this._paused = false;\n  this.emit(\"resume\");\n  this._process();\n};\nEntryWriter.prototype.add = function (entry) {\n  // console.error(\".. ew add\")\n  if (!this.parent) return this.emit(\"error\", new Error(\"no parent\"));\n\n  // make sure that the _header and such is emitted, and clear out\n  // the _currentEntry link on the parent.\n  if (!this._ended) this.end();\n  return this.parent.add(entry);\n};\nEntryWriter.prototype._header = function () {\n  // console.error(\".. ew header\")\n  if (this._didHeader) return;\n  this._didHeader = true;\n  var headerBlock = TarHeader.encode(this.props);\n  if (this.props.needExtended && !this._meta) {\n    var me = this;\n    ExtendedHeaderWriter = ExtendedHeaderWriter || require(\"./extended-header-writer.js\");\n    ExtendedHeaderWriter(this.props).on(\"data\", function (c) {\n      me.emit(\"data\", c);\n    }).on(\"error\", function (er) {\n      me.emit(\"error\", er);\n    }).end();\n  }\n\n  // console.error(\".. .. ew headerBlock emitting\")\n  this.emit(\"data\", headerBlock);\n  this.emit(\"header\");\n};\nEntryWriter.prototype._process = function () {\n  // console.error(\".. .. ew process\")\n  if (!this._didHeader && !this._meta) {\n    this._header();\n  }\n  if (this._paused || this._processing) {\n    // console.error(\".. .. .. paused=%j, processing=%j\", this._paused, this._processing)\n    return;\n  }\n  this._processing = true;\n  var buf = this._buffer;\n  for (var i = 0; i < buf.length; i++) {\n    // console.error(\".. .. .. i=%d\", i)\n\n    var c = buf[i];\n    if (c === EOF) this._stream.end();else this._stream.write(c);\n    if (this._paused) {\n      // console.error(\".. .. .. paused mid-emission\")\n      this._processing = false;\n      if (i < buf.length) {\n        this._needDrain = true;\n        this._buffer = buf.slice(i + 1);\n      }\n      return;\n    }\n  }\n\n  // console.error(\".. .. .. emitted\")\n  this._buffer.length = 0;\n  this._processing = false;\n\n  // console.error(\".. .. .. emitting drain\")\n  this.emit(\"drain\");\n};\nEntryWriter.prototype.destroy = function () {};","map":{"version":3,"names":["module","exports","EntryWriter","tar","require","TarHeader","Entry","inherits","BlockStream","ExtendedHeaderWriter","Stream","EOF","props","me","apply","writable","readable","_stream","on","c","emit","type","size","ustar","ustarver","path","_buffer","_didHeader","_meta","_process","prototype","write","_ended","Error","push","_needDrain","length","end","pause","_paused","resume","add","entry","parent","_header","headerBlock","encode","needExtended","er","_processing","buf","i","slice","destroy"],"sources":["/Users/lieo/diabetes/CUT2DMTest/node_modules/node-gyp/node_modules/tar/lib/entry-writer.js"],"sourcesContent":["module.exports = EntryWriter\n\nvar tar = require(\"../tar.js\")\n  , TarHeader = require(\"./header.js\")\n  , Entry = require(\"./entry.js\")\n  , inherits = require(\"inherits\")\n  , BlockStream = require(\"block-stream\")\n  , ExtendedHeaderWriter\n  , Stream = require(\"stream\").Stream\n  , EOF = {}\n\ninherits(EntryWriter, Stream)\n\nfunction EntryWriter (props) {\n  var me = this\n\n  if (!(me instanceof EntryWriter)) {\n    return new EntryWriter(props)\n  }\n\n  Stream.apply(this)\n\n  me.writable = true\n  me.readable = true\n\n  me._stream = new BlockStream(512)\n\n  me._stream.on(\"data\", function (c) {\n    me.emit(\"data\", c)\n  })\n\n  me._stream.on(\"drain\", function () {\n    me.emit(\"drain\")\n  })\n\n  me._stream.on(\"end\", function () {\n    me.emit(\"end\")\n    me.emit(\"close\")\n  })\n\n  me.props = props\n  if (props.type === \"Directory\") {\n    props.size = 0\n  }\n  props.ustar = \"ustar\\0\"\n  props.ustarver = \"00\"\n  me.path = props.path\n\n  me._buffer = []\n  me._didHeader = false\n  me._meta = false\n\n  me.on(\"pipe\", function () {\n    me._process()\n  })\n}\n\nEntryWriter.prototype.write = function (c) {\n  // console.error(\".. ew write\")\n  if (this._ended) return this.emit(\"error\", new Error(\"write after end\"))\n  this._buffer.push(c)\n  this._process()\n  this._needDrain = this._buffer.length > 0\n  return !this._needDrain\n}\n\nEntryWriter.prototype.end = function (c) {\n  // console.error(\".. ew end\")\n  if (c) this._buffer.push(c)\n  this._buffer.push(EOF)\n  this._ended = true\n  this._process()\n  this._needDrain = this._buffer.length > 0\n}\n\nEntryWriter.prototype.pause = function () {\n  // console.error(\".. ew pause\")\n  this._paused = true\n  this.emit(\"pause\")\n}\n\nEntryWriter.prototype.resume = function () {\n  // console.error(\".. ew resume\")\n  this._paused = false\n  this.emit(\"resume\")\n  this._process()\n}\n\nEntryWriter.prototype.add = function (entry) {\n  // console.error(\".. ew add\")\n  if (!this.parent) return this.emit(\"error\", new Error(\"no parent\"))\n\n  // make sure that the _header and such is emitted, and clear out\n  // the _currentEntry link on the parent.\n  if (!this._ended) this.end()\n\n  return this.parent.add(entry)\n}\n\nEntryWriter.prototype._header = function () {\n  // console.error(\".. ew header\")\n  if (this._didHeader) return\n  this._didHeader = true\n\n  var headerBlock = TarHeader.encode(this.props)\n\n  if (this.props.needExtended && !this._meta) {\n    var me = this\n\n    ExtendedHeaderWriter = ExtendedHeaderWriter ||\n      require(\"./extended-header-writer.js\")\n\n    ExtendedHeaderWriter(this.props)\n      .on(\"data\", function (c) {\n        me.emit(\"data\", c)\n      })\n      .on(\"error\", function (er) {\n        me.emit(\"error\", er)\n      })\n      .end()\n  }\n\n  // console.error(\".. .. ew headerBlock emitting\")\n  this.emit(\"data\", headerBlock)\n  this.emit(\"header\")\n}\n\nEntryWriter.prototype._process = function () {\n  // console.error(\".. .. ew process\")\n  if (!this._didHeader && !this._meta) {\n    this._header()\n  }\n\n  if (this._paused || this._processing) {\n    // console.error(\".. .. .. paused=%j, processing=%j\", this._paused, this._processing)\n    return\n  }\n\n  this._processing = true\n\n  var buf = this._buffer\n  for (var i = 0; i < buf.length; i ++) {\n    // console.error(\".. .. .. i=%d\", i)\n\n    var c = buf[i]\n\n    if (c === EOF) this._stream.end()\n    else this._stream.write(c)\n\n    if (this._paused) {\n      // console.error(\".. .. .. paused mid-emission\")\n      this._processing = false\n      if (i < buf.length) {\n        this._needDrain = true\n        this._buffer = buf.slice(i + 1)\n      }\n      return\n    }\n  }\n\n  // console.error(\".. .. .. emitted\")\n  this._buffer.length = 0\n  this._processing = false\n\n  // console.error(\".. .. .. emitting drain\")\n  this.emit(\"drain\")\n}\n\nEntryWriter.prototype.destroy = function () {}\n"],"mappings":"AAAAA,MAAM,CAACC,OAAO,GAAGC,WAAW;AAE5B,IAAIC,GAAG,GAAGC,OAAO,CAAC,WAAW,CAAC;EAC1BC,SAAS,GAAGD,OAAO,CAAC,aAAa,CAAC;EAClCE,KAAK,GAAGF,OAAO,CAAC,YAAY,CAAC;EAC7BG,QAAQ,GAAGH,OAAO,CAAC,UAAU,CAAC;EAC9BI,WAAW,GAAGJ,OAAO,CAAC,cAAc,CAAC;EACrCK,oBAAoB;EACpBC,MAAM,GAAGN,OAAO,CAAC,QAAQ,CAAC,CAACM,MAAM;EACjCC,GAAG,GAAG,CAAC,CAAC;AAEZJ,QAAQ,CAACL,WAAW,EAAEQ,MAAM,CAAC;AAE7B,SAASR,WAAW,CAAEU,KAAK,EAAE;EAC3B,IAAIC,EAAE,GAAG,IAAI;EAEb,IAAI,EAAEA,EAAE,YAAYX,WAAW,CAAC,EAAE;IAChC,OAAO,IAAIA,WAAW,CAACU,KAAK,CAAC;EAC/B;EAEAF,MAAM,CAACI,KAAK,CAAC,IAAI,CAAC;EAElBD,EAAE,CAACE,QAAQ,GAAG,IAAI;EAClBF,EAAE,CAACG,QAAQ,GAAG,IAAI;EAElBH,EAAE,CAACI,OAAO,GAAG,IAAIT,WAAW,CAAC,GAAG,CAAC;EAEjCK,EAAE,CAACI,OAAO,CAACC,EAAE,CAAC,MAAM,EAAE,UAAUC,CAAC,EAAE;IACjCN,EAAE,CAACO,IAAI,CAAC,MAAM,EAAED,CAAC,CAAC;EACpB,CAAC,CAAC;EAEFN,EAAE,CAACI,OAAO,CAACC,EAAE,CAAC,OAAO,EAAE,YAAY;IACjCL,EAAE,CAACO,IAAI,CAAC,OAAO,CAAC;EAClB,CAAC,CAAC;EAEFP,EAAE,CAACI,OAAO,CAACC,EAAE,CAAC,KAAK,EAAE,YAAY;IAC/BL,EAAE,CAACO,IAAI,CAAC,KAAK,CAAC;IACdP,EAAE,CAACO,IAAI,CAAC,OAAO,CAAC;EAClB,CAAC,CAAC;EAEFP,EAAE,CAACD,KAAK,GAAGA,KAAK;EAChB,IAAIA,KAAK,CAACS,IAAI,KAAK,WAAW,EAAE;IAC9BT,KAAK,CAACU,IAAI,GAAG,CAAC;EAChB;EACAV,KAAK,CAACW,KAAK,GAAG,SAAS;EACvBX,KAAK,CAACY,QAAQ,GAAG,IAAI;EACrBX,EAAE,CAACY,IAAI,GAAGb,KAAK,CAACa,IAAI;EAEpBZ,EAAE,CAACa,OAAO,GAAG,EAAE;EACfb,EAAE,CAACc,UAAU,GAAG,KAAK;EACrBd,EAAE,CAACe,KAAK,GAAG,KAAK;EAEhBf,EAAE,CAACK,EAAE,CAAC,MAAM,EAAE,YAAY;IACxBL,EAAE,CAACgB,QAAQ,EAAE;EACf,CAAC,CAAC;AACJ;AAEA3B,WAAW,CAAC4B,SAAS,CAACC,KAAK,GAAG,UAAUZ,CAAC,EAAE;EACzC;EACA,IAAI,IAAI,CAACa,MAAM,EAAE,OAAO,IAAI,CAACZ,IAAI,CAAC,OAAO,EAAE,IAAIa,KAAK,CAAC,iBAAiB,CAAC,CAAC;EACxE,IAAI,CAACP,OAAO,CAACQ,IAAI,CAACf,CAAC,CAAC;EACpB,IAAI,CAACU,QAAQ,EAAE;EACf,IAAI,CAACM,UAAU,GAAG,IAAI,CAACT,OAAO,CAACU,MAAM,GAAG,CAAC;EACzC,OAAO,CAAC,IAAI,CAACD,UAAU;AACzB,CAAC;AAEDjC,WAAW,CAAC4B,SAAS,CAACO,GAAG,GAAG,UAAUlB,CAAC,EAAE;EACvC;EACA,IAAIA,CAAC,EAAE,IAAI,CAACO,OAAO,CAACQ,IAAI,CAACf,CAAC,CAAC;EAC3B,IAAI,CAACO,OAAO,CAACQ,IAAI,CAACvB,GAAG,CAAC;EACtB,IAAI,CAACqB,MAAM,GAAG,IAAI;EAClB,IAAI,CAACH,QAAQ,EAAE;EACf,IAAI,CAACM,UAAU,GAAG,IAAI,CAACT,OAAO,CAACU,MAAM,GAAG,CAAC;AAC3C,CAAC;AAEDlC,WAAW,CAAC4B,SAAS,CAACQ,KAAK,GAAG,YAAY;EACxC;EACA,IAAI,CAACC,OAAO,GAAG,IAAI;EACnB,IAAI,CAACnB,IAAI,CAAC,OAAO,CAAC;AACpB,CAAC;AAEDlB,WAAW,CAAC4B,SAAS,CAACU,MAAM,GAAG,YAAY;EACzC;EACA,IAAI,CAACD,OAAO,GAAG,KAAK;EACpB,IAAI,CAACnB,IAAI,CAAC,QAAQ,CAAC;EACnB,IAAI,CAACS,QAAQ,EAAE;AACjB,CAAC;AAED3B,WAAW,CAAC4B,SAAS,CAACW,GAAG,GAAG,UAAUC,KAAK,EAAE;EAC3C;EACA,IAAI,CAAC,IAAI,CAACC,MAAM,EAAE,OAAO,IAAI,CAACvB,IAAI,CAAC,OAAO,EAAE,IAAIa,KAAK,CAAC,WAAW,CAAC,CAAC;;EAEnE;EACA;EACA,IAAI,CAAC,IAAI,CAACD,MAAM,EAAE,IAAI,CAACK,GAAG,EAAE;EAE5B,OAAO,IAAI,CAACM,MAAM,CAACF,GAAG,CAACC,KAAK,CAAC;AAC/B,CAAC;AAEDxC,WAAW,CAAC4B,SAAS,CAACc,OAAO,GAAG,YAAY;EAC1C;EACA,IAAI,IAAI,CAACjB,UAAU,EAAE;EACrB,IAAI,CAACA,UAAU,GAAG,IAAI;EAEtB,IAAIkB,WAAW,GAAGxC,SAAS,CAACyC,MAAM,CAAC,IAAI,CAAClC,KAAK,CAAC;EAE9C,IAAI,IAAI,CAACA,KAAK,CAACmC,YAAY,IAAI,CAAC,IAAI,CAACnB,KAAK,EAAE;IAC1C,IAAIf,EAAE,GAAG,IAAI;IAEbJ,oBAAoB,GAAGA,oBAAoB,IACzCL,OAAO,CAAC,6BAA6B,CAAC;IAExCK,oBAAoB,CAAC,IAAI,CAACG,KAAK,CAAC,CAC7BM,EAAE,CAAC,MAAM,EAAE,UAAUC,CAAC,EAAE;MACvBN,EAAE,CAACO,IAAI,CAAC,MAAM,EAAED,CAAC,CAAC;IACpB,CAAC,CAAC,CACDD,EAAE,CAAC,OAAO,EAAE,UAAU8B,EAAE,EAAE;MACzBnC,EAAE,CAACO,IAAI,CAAC,OAAO,EAAE4B,EAAE,CAAC;IACtB,CAAC,CAAC,CACDX,GAAG,EAAE;EACV;;EAEA;EACA,IAAI,CAACjB,IAAI,CAAC,MAAM,EAAEyB,WAAW,CAAC;EAC9B,IAAI,CAACzB,IAAI,CAAC,QAAQ,CAAC;AACrB,CAAC;AAEDlB,WAAW,CAAC4B,SAAS,CAACD,QAAQ,GAAG,YAAY;EAC3C;EACA,IAAI,CAAC,IAAI,CAACF,UAAU,IAAI,CAAC,IAAI,CAACC,KAAK,EAAE;IACnC,IAAI,CAACgB,OAAO,EAAE;EAChB;EAEA,IAAI,IAAI,CAACL,OAAO,IAAI,IAAI,CAACU,WAAW,EAAE;IACpC;IACA;EACF;EAEA,IAAI,CAACA,WAAW,GAAG,IAAI;EAEvB,IAAIC,GAAG,GAAG,IAAI,CAACxB,OAAO;EACtB,KAAK,IAAIyB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,GAAG,CAACd,MAAM,EAAEe,CAAC,EAAG,EAAE;IACpC;;IAEA,IAAIhC,CAAC,GAAG+B,GAAG,CAACC,CAAC,CAAC;IAEd,IAAIhC,CAAC,KAAKR,GAAG,EAAE,IAAI,CAACM,OAAO,CAACoB,GAAG,EAAE,MAC5B,IAAI,CAACpB,OAAO,CAACc,KAAK,CAACZ,CAAC,CAAC;IAE1B,IAAI,IAAI,CAACoB,OAAO,EAAE;MAChB;MACA,IAAI,CAACU,WAAW,GAAG,KAAK;MACxB,IAAIE,CAAC,GAAGD,GAAG,CAACd,MAAM,EAAE;QAClB,IAAI,CAACD,UAAU,GAAG,IAAI;QACtB,IAAI,CAACT,OAAO,GAAGwB,GAAG,CAACE,KAAK,CAACD,CAAC,GAAG,CAAC,CAAC;MACjC;MACA;IACF;EACF;;EAEA;EACA,IAAI,CAACzB,OAAO,CAACU,MAAM,GAAG,CAAC;EACvB,IAAI,CAACa,WAAW,GAAG,KAAK;;EAExB;EACA,IAAI,CAAC7B,IAAI,CAAC,OAAO,CAAC;AACpB,CAAC;AAEDlB,WAAW,CAAC4B,SAAS,CAACuB,OAAO,GAAG,YAAY,CAAC,CAAC"},"metadata":{},"sourceType":"script"}